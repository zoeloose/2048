"use strict";var game={RN:4,CN:4,data:null,score:0,status:1,GAMEOVER:0,RUNNING:1,start:function(){this.status=this.RUNNING;this.score=0;this.data=[];for(var r=0;r<this.RN;r++){this.data[r]=[];for(var c=0;c<this.CN;c++){this.data[r][c]=0}}this.randomNum();this.randomNum();this.updateView()},randomNum:function(){while(true){var r=(Math.random()*this.RN)^0;var c=(Math.random()*this.CN)^0;if(this.data[r][c]==0){this.data[r][c]=Math.random()<0.5?2:4;break}}},updateView:function(){for(var r=0;r<this.RN;r++){for(var c=0;c<this.CN;c++){var div=document.getElementById("c"+r+c);if(this.data[r][c]!=0){div.innerHTML=this.data[r][c];div.className="cell n"+this.data[r][c]}else{div.innerHTML="";div.className="cell"}}}var span=document.getElementsByClassName("score")[0];span.innerHTML=this.score;var gameover=document.getElementById("gameover");if(this.status==this.GAMEOVER){document.getElementsByClassName("final")[0].innerHTML=this.score;gameover.style.display="block"}else{gameover.style.display="none"}},isGAMEOVER:function(){for(var r=0;r<this.RN;r++){for(var c=0;c<this.CN;c++){if(this.data[r][c]==0){return false}if(c<this.CN-1&&this.data[r][c]==this.data[r][c+1]){return false}if(r<this.RN-1&&this.data[r][c]==this.data[r+1][c]){return false}}}return true},moveLeft:function(){var before=String(this.data);for(var r=0;r<this.RN;r++){this.moveLeftInRow(r)}var after=String(this.data);if(before!=after){this.randomNum();if(this.isGAMEOVER()){this.status=this.GAMEOVER}this.updateView()}},moveLeftInRow:function(r){for(var c=0;c<this.CN-1;c++){var nextc=this.getNextInRow(r,c);if(nextc==-1){break}else{if(this.data[r][c]==0){this.data[r][c]=this.data[r][nextc];this.data[r][nextc]=0;c--}else{if(this.data[r][c]==this.data[r][nextc]){this.data[r][c]*=2;this.score+=this.data[r][c];this.data[r][nextc]=0}}}}},getNextInRow:function(r,c){for(var nextc=c+1;nextc<this.CN;nextc++){if(this.data[r][nextc]!=0){return nextc}}return -1},moveRight:function(){var before=String(this.data);for(var r=0;r<this.RN;r++){this.moveRightInRow(r)}var after=String(this.data);if(before!=after){this.randomNum();if(this.isGAMEOVER()){this.status=this.GAMEOVER}this.updateView()}},moveRightInRow:function(r){for(var c=this.CN-1;c>0;c--){var prevc=this.getPrevInRow(r,c);if(prevc==-1){break}else{if(this.data[r][c]==0){this.data[r][c]=this.data[r][prevc];this.data[r][prevc]=0;c++}else{if(this.data[r][c]==this.data[r][prevc]){this.data[r][c]*=2;this.score+=this.data[r][c];this.data[r][prevc]=0}}}}},getPrevInRow:function(r,c){for(var prevc=c-1;prevc>=0;prevc--){if(this.data[r][prevc]!=0){return prevc}}return -1},moveUp:function(){var before=String(this.data);for(var c=0;c<this.CN;c++){this.moveUpInCol(c)}var after=String(this.data);if(before!=after){this.randomNum();if(this.isGAMEOVER()){this.status=this.GAMEOVER}this.updateView()}},moveUpInCol:function(c){for(var r=0;r<this.RN-1;r++){var nextr=this.getUpInRow(r,c);if(nextr==-1){break}else{if(this.data[r][c]==0){this.data[r][c]=this.data[nextr][c];this.data[nextr][c]=0;r--}else{if(this.data[r][c]==this.data[nextr][c]){this.data[r][c]*=2;this.score+=this.data[r][c];this.data[nextr][c]=0}}}}},getUpInRow:function(r,c){for(var nextr=r+1;nextr<this.RN;nextr++){if(this.data[nextr][c]!=0){return nextr}}return -1},moveDown:function(){var before=String(this.data);for(var c=0;c<this.CN;c++){this.moveDownInCol(c)}var after=String(this.data);if(before!=after){this.randomNum();if(this.isGAMEOVER()){this.status=this.GAMEOVER}this.updateView()}},moveDownInCol:function(c){for(var r=this.RN-1;r>0;r--){var prevr=this.getDownInRow(r,c);if(prevr==-1){break}else{if(this.data[r][c]==0){this.data[r][c]=this.data[prevr][c];this.data[prevr][c]=0;r++}else{if(this.data[r][c]==this.data[prevr][c]){this.data[r][c]*=2;this.score+=this.data[r][c];this.data[prevr][c]=0}}}}},getDownInRow:function(r,c){for(var prevr=r-1;prevr>=0;prevr--){if(this.data[prevr][c]!=0){return prevr}}return -1}};window.onload=function(){game.start();document.onkeydown=function(event){var e=event||window.event;var keyCode=e.keyCode||e.which;switch(keyCode){case 37:game.moveLeft();break;case 38:game.moveUp();break;case 39:game.moveRight();break;case 40:game.moveDown()}}};